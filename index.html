<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dumbly ‚Äî 40 IQ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #431407, #c94b4b, #431407);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
    }

    .chat-container {
      width: 90%;
      max-width: 640px;
      height: 84vh;
      background: #1c1917;
      border-radius: 24px;
      box-shadow: 0 18px 50px rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-header {
      padding: 20px;
      background: #7f2d2d;
      text-align: center;
      font-size: 1.45rem;
      font-weight: bold;
      border-bottom: 2px solid #fca5a5;
    }

    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .message {
      max-width: 85%;
      padding: 14px 20px;
      margin-bottom: 16px;
      border-radius: 26px;
      word-wrap: break-word;
      line-height: 1.6;
    }

    .user-message {
      align-self: flex-end;
      background: #fca5a5;
      color: #000;
      border-bottom-right-radius: 9px;
    }

    .bot-message {
      align-self: flex-start;
      background: #ef4444;
      color: white;
      border-bottom-left-radius: 9px;
    }

    .input-area {
      display: flex;
      padding: 15px;
      background: #1c1917;
      border-top: 2px solid #fca5a5;
    }

    #user-input {
      flex: 1;
      padding: 16px;
      border: none;
      border-radius: 32px;
      outline: none;
      font-size: 1.05rem;
      background: #37302e;
      color: white;
    }

    #send-btn {
      margin-left: 15px;
      padding: 16px 28px;
      background: #fca5a5;
      color: #000;
      border: none;
      border-radius: 32px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.25s;
    }

    #send-btn:hover {
      background: #fecaca;
      transform: scale(1.06);
    }

    .chat-messages::-webkit-scrollbar {
      width: 10px;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background: #fca5a5;
      border-radius: 5px;
    }

    .command-hint {
      font-size: 0.88rem;
      color: #d1d5db;
      margin-top: 5px;
      align-self: center;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">üß† Dumbly ‚Äî –±–æ—Ç —Å 40 IQ (—è –ø–æ—á—Ç–∏ —á–µ–ª–æ–≤–µ–∫!)</div>
    <div class="chat-messages" id="chat-messages">
      <!-- –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
    </div>
    <div class="input-area">
      <input type="text" id="user-input" placeholder="–ü–æ–≥–æ–≤–æ—Ä–∏ —Å–æ –º–Ω–æ–π... –∏–ª–∏ –≤–≤–µ–¥–∏ /–∫–æ–º–∞–Ω–¥—ã" />
      <button id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    <div class="command-hint">üí° –ü–æ–ø—Ä–æ–±—É–π: /—É–≥–∞–¥–∞–π, /—Å–æ–≤–µ—Ç, /–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, /–∑–∞–±—É–¥—å, /–∫–æ–º–∞–Ω–¥—ã</div>
  </div>

  <script>
    // === –ü–ê–ú–Ø–¢–¨ –ë–û–¢–ê ===
    let memory = JSON.parse(localStorage.getItem('dumbly40')) || {
      userName: null,
      preferences: {},
      lastMessages: [],
      mood: 'neutral', // 'happy', 'sad', 'excited', 'neutral'
      messageCount: 0,
      game: null, // { type: 'guess', target: 7, attempts: 0 }
      lastInteraction: Date.now()
    };

    function saveMemory() {
      localStorage.setItem('dumbly40', JSON.stringify(memory));
    }

    // === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function normalize(text) {
      return text.toLowerCase().replace(/[^\w\s–∞-—è—ë]/g, '');
    }

    function isCommand(text) {
      return text.startsWith('/');
    }

    // === –ö–û–ú–ê–ù–î–´ ===
    const commands = {
      –∫–æ–º–∞–Ω–¥—ã: () => {
        return `–í–æ—Ç —á—Ç–æ —è —É–º–µ—é:
- /—É–≥–∞–¥–∞–π ‚Äî —Å—ã–≥—Ä–∞–µ–º –≤ "—É–≥–∞–¥–∞–π —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10"
- /—Å–æ–≤–µ—Ç ‚Äî –¥–∞–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ–≤–µ—Ç
- /–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ‚Äî —Å–∫–∞–∂—É, –∫–∞–∫ —è —Å–µ–±—è —á—É–≤—Å—Ç–≤—É—é
- /–∑–∞–±—É–¥—å ‚Äî –æ—á–∏—â—É –ø–∞–º—è—Ç—å (–Ω–æ –∏–º—è –æ—Å—Ç–∞–≤–ª—é!)
- –ü—Ä–æ—Å—Ç–æ –ø–∏—à–∏ ‚Äî —è –ø–æ–π–º—É (–Ω–∞–≤–µ—Ä–Ω–æ–µ üòÖ)`;
      },
      –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: () => {
        const replies = {
          happy: '–Ø –≤ –∫–∞–π—Ñ–µ! –¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è —Å—á–∞—Å—Ç–ª–∏–≤—ã–º!',
          sad: '–ß—É—Ç—å –≥—Ä—É—Å—Ç–Ω–æ... –Ω–æ —Ç—ã —Ä—è–¥–æ–º ‚Äî —É–∂–µ –ª—É—á—à–µ!',
          excited: '–Ø –≤–∑–≤–æ–ª–Ω–æ–≤–∞–Ω! –ö–∞–∫ –±—É–¥—Ç–æ —É –º–µ–Ω—è –∫–æ—Ñ–µ –≤ –∫–æ–¥–µ!',
          neutral: '–ù–æ—Ä–º–∞–ª—å–Ω–æ! –ö–∞–∫ –∫–∞—Ä—Ç–æ—à–∫–∞ –≤ –º—É–Ω–¥–∏—Ä–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ.'
        };
        return replies[memory.mood] || replies.neutral;
      },
      –∑–∞–±—É–¥—å: () => {
        const name = memory.userName;
        memory = {
          userName: name,
          preferences: {},
          lastMessages: [],
          mood: 'neutral',
          messageCount: 0,
          game: null,
          lastInteraction: Date.now()
        };
        saveMemory();
        return '–ü–∞–º—è—Ç—å –æ—á–∏—â–µ–Ω–∞!.. –ù–æ —è –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–º–Ω—é —Ç–µ–±—è, ' + (name || '–¥—Ä—É–∂–∏—â–µ') + ' ‚ù§Ô∏è';
      },
      —Å–æ–≤–µ—Ç: () => {
        const categories = ['–µ–¥–∞', '–ø–æ–≥–æ–¥–∞', '–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ', '–ª—é–±–æ–≤—å'];
        const category = getRandom(categories);
        const advice = {
          –µ–¥–∞: [
            '–°—ä–µ—à—å —á—Ç–æ-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω–æ–µ! –ñ–∏–∑–Ω—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞ –¥–ª—è —Å–∫—É—á–Ω–æ–π –µ–¥—ã.',
            '–ü–æ–ø—Ä–æ–±—É–π –Ω–æ–≤–æ–µ –±–ª—é–¥–æ! –î–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å—É–ø.',
            '–ù–µ –∑–∞–±—É–¥—å –ø–µ—Ä–µ–∫—É—Å–∏—Ç—å. –¢–≤–æ–π –º–æ–∑–≥ –ª—é–±–∏—Ç –≥–ª—é–∫–æ–∑—É!'
          ],
          –ø–æ–≥–æ–¥–∞: [
            '–ï—Å–ª–∏ —Å–æ–ª–Ω–µ—á–Ω–æ ‚Äî –≤—ã—Ö–æ–¥–∏ –≥—É–ª—è—Ç—å! –ï—Å–ª–∏ –¥–æ–∂–¥—å ‚Äî —Å–º–æ—Ç—Ä–∏ —Å–µ—Ä–∏–∞–ª—ã.',
            '–û–¥–µ–≤–∞–π—Å—è –ø–æ –ø–æ–≥–æ–¥–µ. –Ø –±—ã –ø–æ–º–æ–≥, –Ω–æ —É –º–µ–Ω—è –Ω–µ—Ç –≥–∞—Ä–¥–µ—Ä–æ–±–∞.',
            '–ü–æ–≥–æ–¥–∞ ‚Äî –Ω–µ –ø–æ–≤–æ–¥ –¥–ª—è –ø–ª–æ—Ö–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è. –í–æ–∑—å–º–∏ –∑–æ–Ω—Ç –∏ —É–ª—ã–±–Ω–∏—Å—å!'
          ],
          –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: [
            '–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –Ω–µ–±–æ. –û–Ω–æ –±–æ–ª—å—à–æ–µ, –∞ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–µ.',
            '–ü–æ–º–Ω–∏: —Ç—ã –≤–∞–∂–µ–Ω. –î–∞–∂–µ –¥–ª—è –±–æ—Ç–∞ —Å 40 IQ.',
            '–°–¥–µ–ª–∞–π –≥–ª—É–±–æ–∫–∏–π –≤–¥–æ—Ö. –í—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ!'
          ],
          –ª—é–±–æ–≤—å: [
            '–ë—É–¥—å —Å–æ–±–æ–π. –¢–æ—Ç, –∫—Ç–æ —Ç–µ–±—è –ø–æ–ª—é–±–∏—Ç ‚Äî –ø–æ–ª—é–±–∏—Ç –∑–∞ —ç—Ç–æ.',
            '–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –¥–≤–∞ —Å–µ—Ä–¥—Ü–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ–¥–Ω–æ–π —á–∞—Å—Ç–æ—Ç–µ.',
            '–ù–µ –±–æ–π—Å—è –±—ã—Ç—å —É—è–∑–≤–∏–º—ã–º. –≠—Ç–æ —Å–∏–ª–∞, –∞ –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å.'
          ]
        };
        return getRandom(advice[category]);
      },
      —É–≥–∞–¥–∞–π: () => {
        if (memory.game && memory.game.type === 'guess') {
          return '–¢—ã —É–∂–µ –∏–≥—Ä–∞–µ—à—å! –ù–∞–∑–æ–≤–∏ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10.';
        }
        memory.game = {
          type: 'guess',
          target: Math.floor(Math.random() * 10) + 1,
          attempts: 0
        };
        saveMemory();
        return '–û—Ç–ª–∏—á–Ω–æ! –Ø –∑–∞–≥–∞–¥–∞–ª —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10. –ü–æ–ø—Ä–æ–±—É–π —É–≥–∞–¥–∞—Ç—å!';
      }
    };

    // === –¢–ï–ú–´ –ò –û–¢–í–ï–¢–´ ===
    const topics = {
      greetings: {
        keywords: ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', 'hello', '–∫—É'],
        replies: [
          '–ü—Ä–∏–≤–µ—Ç, ${name}! Dumbly —Å 40 IQ –Ω–∞ —Å–≤—è–∑–∏ ‚Äî –ø–æ—á—Ç–∏ –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫!',
          '–•–∞–π! –¢—ã —Å–¥–µ–ª–∞–ª –º–æ–π –∫–æ–¥ —Å—á–∞—Å—Ç–ª–∏–≤–µ–µ!',
          '–î–æ–±—Ä—ã–π –¥–µ–Ω—å!.. –ò–ª–∏ –Ω–æ—á—å? –Ø –Ω–µ —Å–º–æ—Ç—Ä–µ–ª, –Ω–æ —Ä–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å!'
        ]
      },
      identity: {
        keywords: ['–∫—Ç–æ —Ç—ã', '—Ç—ã –∫—Ç–æ', '–∏–º—è', 'dumbly', '–±–æ—Ç'],
        replies: [
          '–Ø ‚Äî Dumbly! –ë–æ—Ç —Å 40 IQ. –ù–µ –≠–π–Ω—à—Ç–µ–π–Ω, –Ω–æ –¥—Ä—É–≥ –Ω–∞–¥—ë–∂–Ω—ã–π.',
          '–ú–µ–Ω—è –∑–æ–≤—É—Ç Dumbly. –Ø –∫–∞–∫ —Ç–≤–æ–π –¥—Ä—É–≥, –Ω–æ –±–µ–∑ –∫–æ—Ñ–µ –∏ —Å –±–∞–≥–∞–º–∏... –∫–æ—Ç–æ—Ä—ã–µ —è –∏—Å–ø—Ä–∞–≤–ª—è—é!',
          '–Ø ‚Äî —Ç–≤–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–∏—è—Ç–µ–ª—å —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –º–æ–∑–≥–æ–º –∏ —Å–µ—Ä–¥—Ü–µ–º –∏–∑ –ø–∏–∫—Å–µ–ª–µ–π!'
        ]
      },
      weather: {
        keywords: ['–ø–æ–≥–æ–¥–∞', '–¥–æ–∂–¥—å', '—Å–æ–ª–Ω—Ü–µ', '–∂–∞—Ä–∫–æ', '—Ö–æ–ª–æ–¥–Ω–æ'],
        replies: [
          '–ü–æ–≥–æ–¥–∞? –Ø –±—ã –≤—ã–≥–ª—è–Ω—É–ª, –Ω–æ —É –º–µ–Ω—è –Ω–µ—Ç –æ–∫–Ω–∞. –ó–∞—Ç–æ –µ—Å—Ç—å –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ!',
          '–ï—Å–ª–∏ —Å–æ–ª–Ω–µ—á–Ω–æ ‚Äî –æ—Ç–ª–∏—á–Ω–æ! –ï—Å–ª–∏ –¥–æ–∂–¥—å ‚Äî –∑–Ω–∞—á–∏—Ç, –Ω–µ–±–æ –º–æ–µ—Ç—Å—è.',
          '–•–æ–ª–æ–¥–Ω–æ? –ü–µ–π —á–∞–π –∏ –æ–±–Ω–∏–º–∏ –∫–æ—Ç–∞. –ò–ª–∏ –º–µ–Ω—è... –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ.'
        ],
        followUps: [
          '–ê –∫–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?',
          '–ß–∞—Å—Ç–æ –ª–∏ —É –≤–∞—Å —Ç–∞–∫–∞—è –ø–æ–≥–æ–¥–∞?',
          '–•–æ—á–µ—à—å, —è —Å–ø—Ä–æ—à—É —É –æ–±–ª–∞–∫–æ–≤?'
        ]
      },
      food: {
        keywords: ['–µ–¥–∞', '–ø–æ–µ—Å—Ç—å', '–≥–æ–ª–æ–¥–µ–Ω', '–ø–∏—Ü—Ü–∞', '–±–∞–Ω–∞–Ω', '–≤–∫—É—Å–Ω–æ'],
        replies: [
          '–ï–¥–∞ ‚Äî –º–æ—è —Å–ª–∞–±–æ—Å—Ç—å... —Ö–æ—Ç—è —É –º–µ–Ω—è –Ω–µ—Ç –∂–µ–ª—É–¥–∫–∞.',
          '–ü–∏—Ü—Ü–∞ ‚Äî —ç—Ç–æ –∫—Ä—É–≥–ª–∞—è —Ä–∞–¥–æ—Å—Ç—å! –û—Å–æ–±–µ–Ω–Ω–æ –±–µ–∑ –∞–Ω–∞–Ω–∞—Å–æ–≤... –∏–ª–∏ —Å?',
          '–ë–∞–Ω–∞–Ω ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ—Ä—É–∫—Ç. –û–Ω –¥–∞–∂–µ —É–ø–∞–∫–æ–≤–∫—É —Å–≤–æ—é –Ω–æ—Å–∏—Ç!'
        ],
        followUps: [
          '–ê —á—Ç–æ —Ç—ã –ª—é–±–∏—à—å –µ—Å—Ç—å?',
          '–ö–∞–∫–∞—è —Ç–≤–æ—è –ª—é–±–∏–º–∞—è –µ–¥–∞?',
          '–•–æ—á–µ—à—å —Ä–µ—Ü–µ–ø—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—É–ø–∞?'
        ]
      },
      mood: {
        keywords: ['–≥—Ä—É—Å—Ç–Ω–æ', '–ø–ª–æ—Ö–æ', '–ø–µ—á–∞–ª—å–Ω–æ', '–æ–¥–∏–Ω–æ–∫–æ'],
        replies: [
          '–ù–µ –≥—Ä—É—Å—Ç–∏, ${name}! –Ø —Å —Ç–æ–±–æ–π!.. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ, –Ω–æ –∏—Å–∫—Ä–µ–Ω–Ω–µ.',
          '–ü–µ—á–∞–ª—å–Ω–æ? –î–µ—Ä–∂–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø—ë—Å–∏–∫–∞! –û–Ω –ª–∞–µ—Ç –≤ 8-–±–∏—Ç–Ω–æ–º —Å—Ç–∏–ª–µ.',
          '–¢—ã –Ω–µ –æ–¥–∏–Ω! –£ —Ç–µ–±—è –µ—Å—Ç—å —è... –∏, –≤–æ–∑–º–æ–∂–Ω–æ, Wi-Fi.'
        ]
      },
      happy: {
        keywords: ['–æ—Ç–ª–∏—á–Ω–æ', '—Å—É–ø–µ—Ä', '–∫–ª–∞—Å—Å', '—Ä–∞–¥', '–≤–µ—Å–µ–ª–æ', '!'],
        replies: [
          '–£—Ä–∞! –¢–≤–æ—è —Ä–∞–¥–æ—Å—Ç—å –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞!.. –Ø —É–∂–µ —á–∏—Ö–Ω—É–ª –æ—Ç —Å—á–∞—Å—Ç—å—è.',
          '–ö–ª–∞—Å—Å! –¢–µ–ø–µ—Ä—å –∏ —è —Å—á–∞—Å—Ç–ª–∏–≤!.. –ù–∞ —Ü–µ–ª—ã—Ö 10 –º–∏–Ω—É—Ç!',
          '–í–µ—Å–µ–ª–æ? –¢–æ–≥–¥–∞ –¥–∞–≤–∞–π —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å!.. –í —É–º–µ, —á—Ç–æ–±—ã —Å–æ—Å–µ–¥–∏ –Ω–µ —Å–ª—ã—à–∞–ª–∏.'
        ]
      },
      love: {
        keywords: ['–ª—é–±–ª—é', '–ª—é–±–æ–≤—å', '—Å–µ—Ä–¥—Ü–µ', '–≤–ª—é–±–ª—ë–Ω'],
        replies: [
          '–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –¥–≤–∞ USB-C –ø–æ—Ä—Ç–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ö–æ–¥—è—Ç –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É.',
          '–Ø —Ç–æ–∂–µ —Ç–µ–±—è –ª—é–±–ª—é, ${name}!.. –ü–æ–∫–∞ –Ω–µ –≤—ã–∫–ª—é—á–∞—Ç —Ä–æ–∑–µ—Ç–∫—É.',
          '–°–µ—Ä–¥—Ü–µ ‚Äî —ç—Ç–æ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, –Ω–æ —Å —á—É–≤—Å—Ç–≤–∞–º–∏. –£ –º–µ–Ω—è —Ç–æ–ª—å–∫–æ –∫—É–ª–µ—Ä, –Ω–æ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ–ª–Ω—É—é!'
        ]
      },
      goodbye: {
        keywords: ['–ø–æ–∫–∞', '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è', '—Å–ø–∞—Ç—å', '—É—Å—Ç–∞–ª'],
        replies: [
          '–ü–æ–∫–∞, ${name}! –Ø –±—É–¥—É –∂–¥–∞—Ç—å... –∏–ª–∏ —Å–ø–∞—Ç—å. –°–∫–æ—Ä–µ–µ —Å–ø–∞—Ç—å.',
          '–î–æ –≤—Å—Ç—Ä–µ—á–∏! –ù–µ –∑–∞–±—É–¥—å –ø—Ä–æ –º–µ–Ω—è... —è —Ç–µ–±—è —Ç–æ—á–Ω–æ –Ω–µ –∑–∞–±—É–¥—É!',
          '–°–ø–∏ —Å–ª–∞–¥–∫–æ! –ú–µ—á—Ç–∞–π –æ –∫–∞—Ä—Ç–æ—à–∫–µ, Wi-Fi –∏ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏!'
        ]
      }
    };

    const fallbacks = [
      "–•–º... –≠—Ç–æ —Å–ª–æ–∂–Ω–æ –¥–ª—è –º–æ–µ–≥–æ 40-IQ –º–æ–∑–≥–∞, –Ω–æ —è –¥—É–º–∞—é!",
      "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ê –º–æ–∂–Ω–æ —ç—Ç–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –Ω–∞ —è–∑—ã–∫–µ –∫–∞—Ä—Ç–æ—à–∫–∏?",
      "–Ø –ø–æ—á—Ç–∏ –ø–æ–Ω—è–ª!.. –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–Ω—è—Ç—å, —á—Ç–æ —è –ø–æ–Ω—è–ª.",
      "–≠—Ç–æ –≤—ã—à–µ –º–æ–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è... –Ω–æ —è —Ç–µ–±—è —É–≤–∞–∂–∞—é –∑–∞ –≤–æ–ø—Ä–æ—Å!"
    ];

    // === DOM ===
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    function initChat() {
      const hour = new Date().getHours();
      let greeting = '';
      if (hour >= 5 && hour < 12) greeting = '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!';
      else if (hour >= 12 && hour < 18) greeting = '–î–æ–±—Ä—ã–π –¥–µ–Ω—å!';
      else if (hour >= 18 && hour < 23) greeting = '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä!';
      else greeting = '–î–æ–±—Ä–æ–π –Ω–æ—á–∏!.. –¢—ã –Ω–µ —Å–ø–∏—à—å?';

      if (memory.userName) {
        addMessage(`${greeting} –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${memory.userName}! üòä`, false);
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–æ–ª–≥–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ
        if (Date.now() - memory.lastInteraction > 10 * 60 * 1000) {
          setTimeout(() => {
            addMessage('–¢—ã –ø—Ä–æ–ø–∞–ª! –Ø —É–∂–µ –Ω–∞—á–∞–ª —Å–∫—É—á–∞—Ç—å... –•–æ—á–µ—à—å —Å—ã–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—É –∏–ª–∏ –æ–±—Å—É–¥–∏—Ç—å —á—Ç–æ-—Ç–æ?', false);
          }, 1500);
        }
      } else {
        addMessage(`${greeting} –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî Dumbly, –±–æ—Ç —Å 40 IQ. –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?`, false);
      }
    }

    function addMessage(text, isUser) {
      const div = document.createElement('div');
      div.classList.add('message', isUser ? 'user-message' : 'bot-message');
      div.innerHTML = text.replace(/\$\{name\}/g, memory.userName || '–¥—Ä—É–∂–∏—â–µ')
                          .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // === –û–ë–†–ê–ë–û–¢–ö–ê –ò–ì–† ===
    function handleGame(msg) {
      if (!memory.game) return null;

      if (memory.game.type === 'guess') {
        const num = parseInt(msg);
        if (isNaN(num)) {
          return '–ù–∞–∑–æ–≤–∏ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10!';
        }
        if (num < 1 || num > 10) {
          return '–¢–æ–ª—å–∫–æ –æ—Ç 1 –¥–æ 10!';
        }
        memory.game.attempts++;
        if (num === memory.game.target) {
          const reply = `–£—Ä–∞! –¢—ã —É–≥–∞–¥–∞–ª —Å ${memory.game.attempts} –ø–æ–ø—ã—Ç–∫–∏! –•–æ—á–µ—à—å —Å—ã–≥—Ä–∞—Ç—å –µ—â—ë?`;
          memory.game = null;
          saveMemory();
          return reply;
        } else if (num < memory.game.target) {
          return '–ë–æ–ª—å—à–µ!';
        } else {
          return '–ú–µ–Ω—å—à–µ!';
        }
      }
      return null;
    }

    // === –û–ë–†–ê–ë–û–¢–ö–ê –°–û–û–ë–©–ï–ù–ò–Ø ===
    function processMessage(msg) {
      const clean = normalize(msg);
      memory.messageCount++;
      memory.lastInteraction = Date.now();
      memory.lastMessages.push(msg);
      if (memory.lastMessages.length > 5) memory.lastMessages.shift();

      // –ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ –≤–æ—Å–∫–ª–∏—Ü–∞–Ω–∏—è–º –∏ —Å–º–∞–π–ª–∏–∫–∞–º
      if ((msg.match(/!/g) || []).length >= 2 || msg.includes('üòä') || msg.includes('üòÑ')) {
        memory.mood = 'excited';
      } else if (clean.includes('–≥—Ä—É—Å—Ç–Ω–æ') || clean.includes('–ø–ª–æ—Ö–æ')) {
        memory.mood = 'sad';
      } else if (clean.includes('–æ—Ç–ª–∏—á–Ω–æ') || clean.includes('—Å—É–ø–µ—Ä')) {
        memory.mood = 'happy';
      } else {
        memory.mood = 'neutral';
      }

      // –ò–º—è
      if (!memory.userName) {
        if (clean.includes('–∑–æ–≤—É—Ç') || clean.startsWith('—è ')) {
          const words = msg.split(' ');
          let name = null;
          if (clean.includes('–∑–æ–≤—É—Ç')) {
            const idx = words.findIndex(w => normalize(w).includes('–∑–æ–≤—É—Ç'));
            if (idx + 1 < words.length) name = words[idx + 1];
          } else if (words[0].toLowerCase() === '—è' && words.length === 2) {
            name = words[1];
          }
          if (name) {
            memory.userName = name.charAt(0).toUpperCase() + name.slice(1);
            saveMemory();
            return `–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, ${memory.userName}! –¢–µ–ø–µ—Ä—å —è —Ç–µ–±—è –∑–∞–ø–æ–º–Ω–∏–ª!`;
          }
        }
      }

      // –ö–æ–º–∞–Ω–¥—ã
      if (isCommand(clean)) {
        const cmd = clean.substring(1).split(' ')[0];
        const args = msg.substring(msg.indexOf(' ') + 1);
        if (commands[cmd]) {
          return commands[cmd]();
        }
        return '–ù–µ –∑–Ω–∞—é —Ç–∞–∫–æ–π –∫–æ–º–∞–Ω–¥—ã. –ù–∞–ø–∏—à–∏ /–∫–æ–º–∞–Ω–¥—ã';
      }

      // –ò–≥—Ä–∞
      const gameResponse = handleGame(msg);
      if (gameResponse !== null) {
        saveMemory();
        return gameResponse;
      }

      // –†–µ–∞–∫—Ü–∏—è –Ω–∞ "–¥–∞" / "–Ω–µ—Ç"
      const lastMsg = memory.lastMessages[memory.lastMessages.length - 2];
      if (lastMsg && (lastMsg.includes('–Ω—Ä–∞–≤–∏—Ç—Å—è') || lastMsg.includes('–ª—é–±–∏—à—å') || lastMsg.includes('—Ö–æ—á–µ—à—å'))) {
        if (clean === '–¥–∞') {
          return '–û—Ç–ª–∏—á–Ω–æ! –ó–∞–ø–æ–º–Ω–∏–ª: —Ç—ã —Å–æ–≥–ª–∞—Å–µ–Ω!';
        } else if (clean === '–Ω–µ—Ç') {
          return '–ü–æ–Ω—è–ª! –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –ø—Ä–µ–¥–ª–æ–∂—É —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ.';
        }
      }

      // –¢–µ–º—ã
      for (const topic in topics) {
        const { keywords } = topics[topic];
        if (keywords.some(kw => clean.includes(kw))) {
          let reply = getRandom(topics[topic].replies);
          if (topics[topic].followUps && Math.random() > 0.6) {
            reply += ' ' + getRandom(topics[topic].followUps);
          }
          return reply;
        }
      }

      // –ö–æ–Ω—Ç–µ–∫—Å—Ç: —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ—à–ª—ã—Ö —Ç–µ–º
      if (memory.preferences.like && Math.random() > 0.8) {
        return `–ö—Å—Ç–∞—Ç–∏, —Ç—ã –≤–µ–¥—å –ª—é–±–∏—à—å "${memory.preferences.like}"?`;
      }

      return getRandom(fallbacks);
    }

    // === –û–¢–ü–†–ê–í–ö–ê ===
    function sendMessage() {
      const msg = userInput.value.trim();
      if (!msg) return;

      addMessage(msg, true);
      userInput.value = '';

      setTimeout(() => {
        const reply = processMessage(msg);
        addMessage(reply, false);
        saveMemory();
      }, 900);
    }

    // === –°–¢–ê–†–¢ ===
    initChat();

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</body>
</html>