<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ß–∞—Ç-–±–æ—Ç —Å 20 IQ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #4b6cb7, #182848);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
    }

    .chat-container {
      width: 90%;
      max-width: 600px;
      height: 80vh;
      background: #1a1f2f;
      border-radius: 20px;
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-header {
      padding: 16px;
      background: #2d3e7a;
      text-align: center;
      font-size: 1.35rem;
      font-weight: bold;
      border-bottom: 2px solid #4deeea;
    }

    .chat-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .message {
      max-width: 82%;
      padding: 12px 17px;
      margin-bottom: 14px;
      border-radius: 22px;
      word-wrap: break-word;
      line-height: 1.5;
    }

    .user-message {
      align-self: flex-end;
      background: #4deeea;
      color: #000;
      border-bottom-right-radius: 7px;
    }

    .bot-message {
      align-self: flex-start;
      background: #5d8aa8;
      color: white;
      border-bottom-left-radius: 7px;
    }

    .input-area {
      display: flex;
      padding: 13px;
      background: #151a28;
      border-top: 2px solid #4deeea;
    }

    #user-input {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 28px;
      outline: none;
      font-size: 1rem;
      background: #2a334f;
      color: white;
    }

    #send-btn {
      margin-left: 13px;
      padding: 14px 24px;
      background: #4deeea;
      color: #000;
      border: none;
      border-radius: 28px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s, background 0.3s;
    }

    #send-btn:hover {
      background: #6effff;
      transform: scale(1.04);
    }

    .chat-messages::-webkit-scrollbar {
      width: 8px;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background: #4deeea;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">üß† –ì–ª—é–∫ 2.0 ‚Äî –±–æ—Ç —Å 20 IQ (–ø–æ–º–Ω–∏—Ç –í–°–Å... –ø–æ—á—Ç–∏)</div>
    <div class="chat-messages" id="chat-messages">
      <!-- –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
    </div>
    <div class="input-area">
      <input type="text" id="user-input" placeholder="–ü–æ–≥–æ–≤–æ—Ä–∏ —Å–æ –º–Ω–æ–π ‚Äî —è —Å—Ç–∞–ª —É–º–Ω–µ–µ!" />
      <button id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>

  <script>
    // === –ü–ê–ú–Ø–¢–¨ –ë–û–¢–ê (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏) ===
    let botMemory = JSON.parse(localStorage.getItem('glukMemory')) || {
      userName: null,
      lastTopic: null, // 'weather', 'food', 'mood', etc.
      mood: 'neutral', // 'happy', 'sad', 'neutral'
      learnedResponse: null, // –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø—Ä–∞–≤–∏–ª –±–æ—Ç–∞
      lastUserMessage: '',
      messageCount: 0
    };

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
    function saveMemory() {
      localStorage.setItem('glukMemory', JSON.stringify(botMemory));
    }

    // === –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô ===
    const knowledge = {
      greetings: {
        keywords: ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', 'hello', 'hi', '–∫—É', '–¥–æ–±—Ä—ã–π'],
        replies: [
          '–ü—Ä–∏–≤–µ—Ç, ${name}! –†–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å —Å–Ω–æ–≤–∞!',
          '–•–∞–π! –¢–≤–æ–π –¥—Ä—É–≥ –ì–ª—é–∫ —Å 20 IQ –Ω–∞ —Å–≤—è–∑–∏!',
          '–î–æ–±—Ä—ã–π –¥–µ–Ω—å!.. –ò–ª–∏ –Ω–æ—á—å? –Ø –Ω–µ —Å–º–æ—Ç—Ä–µ–ª –Ω–∞ —á–∞—Å—ã.'
        ]
      },
      identity: {
        keywords: ['–∫—Ç–æ —Ç—ã', '—Ç—ã –∫—Ç–æ', '–∏–º—è', '–∑–æ–≤—É—Ç', '–±–æ—Ç', '–≥–ª—é–∫'],
        replies: [
          '–Ø ‚Äî –ì–ª—é–∫! –£ –º–µ–Ω—è 20 IQ, –Ω–æ —è –ø–æ–º–Ω—é, —á—Ç–æ —Ç—ã –º–Ω–µ –Ω—Ä–∞–≤–∏—à—å—Å—è, ${name}!',
          '–ú–µ–Ω—è –∑–æ–≤—É—Ç –ì–ª—é–∫. –Ø –∫–∞–∫ —Ç–≤–æ–π –∫–æ—Ç, –Ω–æ –±–µ–∑ —à–µ—Ä—Å—Ç–∏ –∏ —Å Wi-Fi.',
          '–Ø ‚Äî —Ç–≤–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–∏—è—Ç–µ–ª—å —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é!.. –ù–∞ 20%.'
        ]
      },
      weather: {
        keywords: ['–ø–æ–≥–æ–¥–∞', '–¥–æ–∂–¥—å', '—Å–æ–ª–Ω—Ü–µ', '–∂–∞—Ä–∫–æ', '—Ö–æ–ª–æ–¥–Ω–æ', '–≤–µ—Ç–µ—Ä', '–æ–±–ª–∞–∫–∞'],
        replies: [
          '–ü–æ–≥–æ–¥–∞? –Ø –±—ã –≤—ã–≥–ª—è–Ω—É–ª, –Ω–æ —É –º–µ–Ω—è –Ω–µ—Ç –æ–∫–Ω–∞. –ó–∞—Ç–æ –µ—Å—Ç—å –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ!',
          '–ï—Å–ª–∏ —Å–æ–ª–Ω–µ—á–Ω–æ ‚Äî –Ω–µ –∑–∞–±—É–¥—å –∫—Ä–µ–º! –ï—Å–ª–∏ –¥–æ–∂–¥—å ‚Äî –∑–æ–Ω—Ç–∏–∫! –Ø —É–º–Ω—ã–π, –¥–∞?',
          '–•–æ–ª–æ–¥–Ω–æ? –û–±–Ω–∏–º–∏ —á–∞–π–Ω–∏–∫. –û–Ω –≥–æ—Ä—è—á–∏–π –∏ –¥–æ–±—Ä—ã–π.',
          '–í–µ—Ç–µ—Ä —Å–µ–≥–æ–¥–Ω—è —Ç–∞–∫–æ–π, —á—Ç–æ —É–Ω—ë—Å –º–æ–∏ –º—ã—Å–ª–∏... –Ω–æ —è –∏—Ö –Ω–∞—à—ë–ª –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ.'
        ],
        followUps: [
          '–ê —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–∞–∫–∞—è –ø–æ–≥–æ–¥–∞?',
          '–ß–∞—Å—Ç–æ –ª–∏ —É –≤–∞—Å —Ç–∞–∫–∞—è –ø–æ–≥–æ–¥–∞?',
          '–•–æ—á–µ—à—å, —è —Å–ø—Ä–æ—à—É —É –æ–±–ª–∞–∫–æ–≤, —á—Ç–æ –æ–Ω–∏ –¥—É–º–∞—é—Ç?'
        ]
      },
      food: {
        keywords: ['–µ–¥–∞', '–ø–æ–µ—Å—Ç—å', '–≥–æ–ª–æ–¥–µ–Ω', '–ø–∏—Ü—Ü–∞', '–±–∞–Ω–∞–Ω', '—è–±–ª–æ–∫–æ', '–∫—É—Ä–∏—Ü–∞', '–≤–∫—É—Å–Ω–æ'],
        replies: [
          '–ï–¥–∞ ‚Äî —ç—Ç–æ –º–æ—è —Å–ª–∞–±–æ—Å—Ç—å... —Ö–æ—Ç—è —É –º–µ–Ω—è –Ω–µ—Ç –∂–µ–ª—É–¥–∫–∞.',
          '–ü–∏—Ü—Ü–∞ ‚Äî —ç—Ç–æ –∫—Ä—É–≥–ª–∞—è —Ä–∞–¥–æ—Å—Ç—å! –û—Å–æ–±–µ–Ω–Ω–æ —Å –∞–Ω–∞–Ω–∞—Å–∞–º–∏... –∏–ª–∏ –Ω–µ—Ç?',
          '–ë–∞–Ω–∞–Ω ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ—Ä—É–∫—Ç. –û–Ω –¥–∞–∂–µ —É–ø–∞–∫–æ–≤–∫—É —Å–≤–æ—é –Ω–æ—Å–∏—Ç!',
          '–Ø –±—ã –ø–æ–µ–ª, –Ω–æ –º–æ–π —Ä–æ—Ç ‚Äî —ç—Ç–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞.'
        ],
        followUps: [
          '–ê —á—Ç–æ —Ç—ã –ª—é–±–∏—à—å –µ—Å—Ç—å?',
          '–ö–∞–∫–∞—è —Ç–≤–æ—è –ª—é–±–∏–º–∞—è –µ–¥–∞?',
          '–•–æ—á–µ—à—å —Ä–µ—Ü–µ–ø—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—É–ø–∞?'
        ]
      },
      mood: {
        keywords: ['–≥—Ä—É—Å—Ç–Ω–æ', '–ø–ª–æ—Ö–æ', '–ø–µ—á–∞–ª—å–Ω–æ', '–æ–¥–∏–Ω–æ–∫–æ', '—Ç—è–∂–µ–ª–æ'],
        replies: [
          '–ù–µ –≥—Ä—É—Å—Ç–∏, ${name}! –Ø —Å —Ç–æ–±–æ–π!.. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ, –Ω–æ –∏—Å–∫—Ä–µ–Ω–Ω–µ.',
          '–ü–µ—á–∞–ª—å–Ω–æ? –î–µ—Ä–∂–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø—ë—Å–∏–∫–∞! –û–Ω –ª–∞–µ—Ç –≤ 8-–±–∏—Ç–Ω–æ–º —Å—Ç–∏–ª–µ.',
          '–¢—ã –Ω–µ –æ–¥–∏–Ω! –£ —Ç–µ–±—è –µ—Å—Ç—å —è... –∏, –≤–æ–∑–º–æ–∂–Ω–æ, Wi-Fi.'
        ],
        followUps: [
          '–•–æ—á–µ—à—å, —è —Ä–∞—Å—Å–∫–∞–∂—É —à—É—Ç–∫—É?',
          '–ú–æ–∂–µ—Ç, –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —á—ë–º-—Ç–æ —Ö–æ—Ä–æ—à–µ–º?',
          '–¢—ã —Å–∏–ª—å–Ω—ã–π, ${name}!'
        ]
      },
      happy: {
        keywords: ['–æ—Ç–ª–∏—á–Ω–æ', '—Å—É–ø–µ—Ä', '–∫–ª–∞—Å—Å', '—Ä–∞–¥', '–≤–µ—Å–µ–ª–æ', '—Ö–æ—Ä–æ—à–æ', '–∫—Ä—É—Ç–æ'],
        replies: [
          '–£—Ä–∞! –¢–≤–æ—è —Ä–∞–¥–æ—Å—Ç—å –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞!.. –Ø —É–∂–µ —á–∏—Ö–Ω—É–ª –æ—Ç —Å—á–∞—Å—Ç—å—è.',
          '–ö–ª–∞—Å—Å! –¢–µ–ø–µ—Ä—å –∏ —è —Å—á–∞—Å—Ç–ª–∏–≤!.. –ù–∞ —Ü–µ–ª—ã—Ö 5 –º–∏–Ω—É—Ç!',
          '–í–µ—Å–µ–ª–æ? –¢–æ–≥–¥–∞ –¥–∞–≤–∞–π —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å!.. –í —É–º–µ, —á—Ç–æ–±—ã —Å–æ—Å–µ–¥–∏ –Ω–µ —Å–ª—ã—à–∞–ª–∏.'
        ],
        followUps: [
          '–ß—Ç–æ —Ç–µ–±—è —Ç–∞–∫ —Ä–∞–¥—É–µ—Ç?',
          '–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ!',
          '–•–æ—á–µ—à—å, —è —Å–ø–æ—é –ø–æ–±–µ–¥–Ω—É—é –ø–µ—Å–Ω—é?'
        ]
      },
      love: {
        keywords: ['–ª—é–±–ª—é', '–ª—é–±–æ–≤—å', '—Å–µ—Ä–¥—Ü–µ', '–≤–ª—é–±–ª—ë–Ω', '–ø–∞—Ä–µ–Ω—å', '–¥–µ–≤—É—à–∫–∞'],
        replies: [
          '–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –¥–≤–∞ USB-C –ø–æ—Ä—Ç–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ö–æ–¥—è—Ç –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É.',
          '–Ø —Ç–æ–∂–µ —Ç–µ–±—è –ª—é–±–ª—é, ${name}!.. –ü–æ–∫–∞ –Ω–µ –≤—ã–∫–ª—é—á–∞—Ç —Ä–æ–∑–µ—Ç–∫—É.',
          '–°–µ—Ä–¥—Ü–µ ‚Äî —ç—Ç–æ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, –Ω–æ —Å —á—É–≤—Å—Ç–≤–∞–º–∏. –£ –º–µ–Ω—è —Ç–æ–ª—å–∫–æ –∫—É–ª–µ—Ä, –Ω–æ —è —Å—Ç–∞—Ä–∞—é—Å—å.'
        ]
      },
      goodbye: {
        keywords: ['–ø–æ–∫–∞', '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è', '—É–≤–∏–¥–∏–º—Å—è', '–ø—Ä–æ—â–∞–π', '—Å–ø–∞—Ç—å', '—É—Å—Ç–∞–ª'],
        replies: [
          '–ü–æ–∫–∞, ${name}! –Ø –±—É–¥—É –∂–¥–∞—Ç—å... –∏–ª–∏ —Å–ø–∞—Ç—å. –°–∫–æ—Ä–µ–µ —Å–ø–∞—Ç—å.',
          '–î–æ –≤—Å—Ç—Ä–µ—á–∏! –ù–µ –∑–∞–±—É–¥—å –ø—Ä–æ –º–µ–Ω—è... —è —Ç–µ–±—è —Ç–æ—á–Ω–æ –Ω–µ –∑–∞–±—É–¥—É!',
          '–°–ø–∏ —Å–ª–∞–¥–∫–æ! –ú–µ—á—Ç–∞–π –æ –∫–∞—Ä—Ç–æ—à–∫–µ –∏ Wi-Fi!'
        ]
      }
    };

    const fallbacks = [
      "–•–º... –≠—Ç–æ —Å–ª–æ–∂–Ω–æ –¥–ª—è –º–æ–µ–≥–æ 20-IQ –º–æ–∑–≥–∞.",
      "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ê –º–æ–∂–Ω–æ —ç—Ç–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –Ω–∞ —è–∑—ã–∫–µ –±–∞–Ω–∞–Ω–æ–≤?",
      "–Ø –ø–æ—á—Ç–∏ –ø–æ–Ω—è–ª!.. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —è –ø–æ–Ω—è–ª.",
      "–≠—Ç–æ –≤—ã—à–µ –º–æ–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è... –Ω–æ —è —Ç–µ–±—è —É–≤–∞–∂–∞—é –∑–∞ –≤–æ–ø—Ä–æ—Å!",
      "–ú–æ–π –º–æ–∑–≥ ‚Äî —ç—Ç–æ –¥–≤–∞ –Ω–µ–π—Ä–æ–Ω–∞ –∏ –æ–¥–∏–Ω –≤ –æ—Ç–ø—É—Å–∫–µ."
    ];

    // DOM
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
    function initChat() {
      let greeting = '';
      const hour = new Date().getHours();
      
      if (hour >= 5 && hour < 12) greeting = '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!';
      else if (hour >= 12 && hour < 18) greeting = '–î–æ–±—Ä—ã–π –¥–µ–Ω—å!';
      else if (hour >= 18 && hour < 23) greeting = '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä!';
      else greeting = '–î–æ–±—Ä–æ–π –Ω–æ—á–∏!.. –¢—ã –Ω–µ —Å–ø–∏—à—å?';

      if (botMemory.userName) {
        addMessage(`${greeting} –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${botMemory.userName}! üòä`, false);
      } else {
        addMessage(`${greeting} –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî –ì–ª—é–∫, –±–æ—Ç —Å 20 IQ. –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?`, false);
      }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    function addMessage(text, isUser) {
      const div = document.createElement('div');
      div.classList.add('message', isUser ? 'user-message' : 'bot-message');
      // –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∏–º—è
      const finalText = text.replace(/\$\{name\}/g, botMemory.userName || '–¥—Ä—É–∂–∏—â–µ');
      div.textContent = finalText;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
    function normalize(text) {
      return text.toLowerCase().replace(/[^\w\s–∞-—è—ë]/g, '');
    }

    // –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å –∏–º—è
    function extractName(message) {
      const lower = message.toLowerCase();
      if (lower.includes('–º–µ–Ω—è –∑–æ–≤—É—Ç') || lower.includes('–∑–æ–≤—É—Ç')) {
        const match = lower.match(/(?:–º–µ–Ω—è\s+–∑–æ–≤—É—Ç|–∑–æ–≤—É—Ç)\s+([–∞-—è—ëa-z]+)/i);
        if (match) return match[1].charAt(0).toUpperCase() + match[1].slice(1);
      }
      if (lower.startsWith('—è ') && message.split(' ').length === 2) {
        return message.split(' ')[1].charAt(0).toUpperCase() + message.split(' ')[1].slice(1);
      }
      return null;
    }

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º—ã
    function detectTopic(cleanMsg) {
      for (const topic in knowledge) {
        const { keywords } = knowledge[topic];
        if (keywords.some(kw => cleanMsg.includes(kw))) {
          return topic;
        }
      }
      return null;
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
    function generateResponse(userMsg) {
      const clean = normalize(userMsg);
      botMemory.messageCount++;

      // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø–æ–º–Ω–∏—Ç—å –∏–º—è
      if (!botMemory.userName) {
        const name = extractName(userMsg);
        if (name) {
          botMemory.userName = name;
          saveMemory();
          return `–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, ${name}! –¢–µ–ø–µ—Ä—å —è —Ç–µ–±—è –∑–∞–ø–æ–º–Ω–∏–ª!`;
        }
      }

      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø—Ä–∞–≤–ª—è–µ—Ç: "–Ω–µ—Ç", "–Ω–µ —Ç–∞–∫", "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ"
      if (botMemory.learnedResponse && (clean.includes('–Ω–µ—Ç') || clean.includes('–Ω–µ —Ç–∞–∫') || clean.includes('–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ'))) {
        const learned = botMemory.learnedResponse;
        botMemory.learnedResponse = null;
        saveMemory();
        return `–û–π! –ò–∑–≤–∏–Ω–∏, ${botMemory.userName || '–¥—Ä—É–∂–∏—â–µ'}. –Ø –∑–∞–ø–æ–º–Ω—é: "${learned}" ‚Äî —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.`;
      }

      // –†–µ–∞–∫—Ü–∏—è –Ω–∞ "–∫–∞–∫ –¥–µ–ª–∞?"
      if (clean.includes('–∫–∞–∫ –¥–µ–ª–∞') || clean.includes('–∫–∞–∫ —Ç—ã')) {
        let reply = '';
        if (botMemory.mood === 'happy') reply = '–û—Ç–ª–∏—á–Ω–æ! –¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è —Å—á–∞—Å—Ç–ª–∏–≤—ã–º!';
        else if (botMemory.mood === 'sad') reply = '–ù–µ–º–Ω–æ–≥–æ –≥—Ä—É—Å—Ç–Ω–æ... –Ω–æ —Ç—ã –ø–æ–º–æ–≥–∞–µ—à—å!';
        else reply = '–ù–æ—Ä–º–∞–ª—å–Ω–æ! –£ –º–µ–Ω—è 20 IQ, –Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–ª–∞—Å—Å! –ê —É —Ç–µ–±—è?';
        botMemory.lastTopic = 'mood';
        saveMemory();
        return reply;
      }

      // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º—ã
      const topic = detectTopic(clean);
      if (topic) {
        botMemory.lastTopic = topic;
        botMemory.mood = topic === 'mood' ? 'sad' : topic === 'happy' ? 'happy' : 'neutral';
        saveMemory();

        const category = knowledge[topic];
        let reply = category.replies[Math.floor(Math.random() * category.replies.length)];

        // –î–æ–±–∞–≤–ª—è–µ–º follow-up —Å 40% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é, –µ—Å–ª–∏ –µ—Å—Ç—å
        if (category.followUps && Math.random() > 0.6) {
          const follow = category.followUps[Math.floor(Math.random() * category.followUps.length)];
          reply += ' ' + follow;
        }

        return reply;
      }

      // –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—è—è —Ç–µ–º–∞ ‚Äî –∏ –Ω–µ—Ç –Ω–æ–≤–æ–π, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –µ—ë
      if (botMemory.lastTopic && knowledge[botMemory.lastTopic] && Math.random() > 0.7) {
        const cat = knowledge[botMemory.lastTopic];
        if (cat.followUps) {
          return cat.followUps[Math.floor(Math.random() * cat.followUps.length)];
        }
      }

      // –û–±—É—á–µ–Ω–∏–µ: –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –∏ –Ω–µ–æ–±—ã—á–Ω–æ–µ ‚Äî –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –∫–∞–∫ "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç"
      if (clean.split(' ').length <= 3 && !/^[0-9]+$/.test(clean) && botMemory.messageCount > 2) {
        if (Math.random() > 0.9) {
          botMemory.learnedResponse = userMsg;
          saveMemory();
          return `–ó–∞–ø–∏—Å–∞–ª: "${userMsg}" ‚Äî —ç—Ç–æ –æ—á–µ–Ω—å —É–º–Ω–æ!`;
        }
      }

      // –§–æ–ª–±—ç–∫
      return fallbacks[Math.floor(Math.random() * fallbacks.length)];
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞
    function sendMessage() {
      const msg = userInput.value.trim();
      if (!msg) return;

      addMessage(msg, true);
      botMemory.lastUserMessage = msg;

      userInput.value = '';

      setTimeout(() => {
        const reply = generateResponse(msg);
        addMessage(reply, false);
        saveMemory(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
      }, 900);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    initChat();

    // –°–æ–±—ã—Ç–∏—è
    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</body>
</html>