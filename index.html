<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>30 IQ Bot</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
    }

    .chat-container {
      width: 90%;
      max-width: 620px;
      height: 82vh;
      background: #0f172a;
      border-radius: 22px;
      box-shadow: 0 16px 45px rgba(0, 0, 0, 0.6);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-header {
      padding: 18px;
      background: #1e3a8a;
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
      border-bottom: 2px solid #60a5fa;
    }

    .chat-messages {
      flex: 1;
      padding: 18px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .message {
      max-width: 84%;
      padding: 13px 19px;
      margin-bottom: 15px;
      border-radius: 24px;
      word-wrap: break-word;
      line-height: 1.55;
    }

    .user-message {
      align-self: flex-end;
      background: #60a5fa;
      color: #000;
      border-bottom-right-radius: 8px;
    }

    .bot-message {
      align-self: flex-start;
      background: #3b82f6;
      color: white;
      border-bottom-left-radius: 8px;
    }

    .input-area {
      display: flex;
      padding: 14px;
      background: #0f172a;
      border-top: 2px solid #60a5fa;
    }

    #user-input {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: 30px;
      outline: none;
      font-size: 1.05rem;
      background: #1e293b;
      color: white;
    }

    #send-btn {
      margin-left: 14px;
      padding: 15px 26px;
      background: #60a5fa;
      color: #000;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.25s;
    }

    #send-btn:hover {
      background: #93c5fd;
      transform: scale(1.05);
    }

    .chat-messages::-webkit-scrollbar {
      width: 9px;
    }
    .chat-messages::-webkit-scrollbar-thumb {
      background: #60a5fa;
      border-radius: 5px;
    }

    .command-hint {
      font-size: 0.85rem;
      color: #94a3b8;
      margin-top: 4px;
      align-self: center;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">üß† Dumbly ‚Äî –±–æ—Ç —Å 30 IQ (—É–º–Ω—ã–π –¥–ª—è —Å–≤–æ–∏—Ö –ª–µ—Ç!)</div>
    <div class="chat-messages" id="chat-messages">
      <!-- –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
    </div>
    <div class="input-area">
      <input type="text" id="user-input" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å... –∏–ª–∏ /–ø–æ–º–æ—â—å" />
      <button id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    <div class="command-hint">üí° –°–æ–≤–µ—Ç: –ø–æ–ø—Ä–æ–±—É–π –∫–æ–º–∞–Ω–¥—ã: /–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, /–≤—ã–±–µ—Ä–∏, /–∑–∞–±—É–¥—å, /–ø–æ–º–æ—â—å</div>
  </div>

  <script>
    // === –ü–ê–ú–Ø–¢–¨ –ë–û–¢–ê (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage) ===
    let memory = JSON.parse(localStorage.getItem('dumbly30')) || {
      userName: null,
      preferences: {}, // –Ω–∞–ø—Ä–∏–º–µ—Ä: { food: '–ø–∏—Ü—Ü–∞', weather: '—Å–æ–ª–Ω–µ—á–Ω–æ' }
      lastMessages: [], // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      mood: 'neutral',
      messageCount: 0
    };

    function saveMemory() {
      localStorage.setItem('dumbly30', JSON.stringify(memory));
    }

    // === –ü–û–õ–ï–ó–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function normalize(text) {
      return text.toLowerCase().replace(/[^\w\s–∞-—è—ë]/g, '');
    }

    function isCommand(text) {
      return text.startsWith('/');
    }

    // === –ö–û–ú–ê–ù–î–´ ===
    const commands = {
      –ø–æ–º–æ—â—å: () => {
        return `–ü—Ä–∏–≤–µ—Ç! –Ø Dumbly —Å 30 IQ. –ú–æ–≥—É:
- /–≤—ã–±–µ—Ä–∏ [–≤–∞—Ä–∏–∞–Ω—Ç1, –≤–∞—Ä–∏–∞–Ω—Ç2] ‚Äî –ø–æ–º–æ–≥—É —Ä–µ—à–∏—Ç—å
- /–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ‚Äî —Å–∫–∞–∂—É, –∫–∞–∫ —è —Å–µ–±—è —á—É–≤—Å—Ç–≤—É—é
- /–∑–∞–±—É–¥—å ‚Äî –æ—á–∏—â—É –ø–∞–º—è—Ç—å
- –ó–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –ø–æ–≥–æ–¥—É, –µ–¥—É, –ª—é–±–æ–≤—å –∏ —Ç.–¥.
–ü–∏—à–∏ –ø—Ä–æ—Å—Ç–æ ‚Äî —è —Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–Ω—è—Ç—å!`;
      },
      –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: () => {
        const replies = {
          happy: '–Ø –≤ –æ—Ç–ª–∏—á–Ω–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏! –¢—ã –º–µ–Ω—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—à—å!',
          sad: '–ß—É—Ç—å –≥—Ä—É—Å—Ç–Ω–æ... –Ω–æ —Ç—ã —Ä—è–¥–æ–º ‚Äî —É–∂–µ –ª—É—á—à–µ!',
          neutral: '–ù–æ—Ä–º–∞–ª—å–Ω–æ! –ö–∞–∫ –∫–∞—Ä—Ç–æ—à–∫–∞ –≤ –º—É–Ω–¥–∏—Ä–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ.'
        };
        return replies[memory.mood] || replies.neutral;
      },
      –∑–∞–±—É–¥—å: () => {
        memory = {
          userName: memory.userName,
          preferences: {},
          lastMessages: [],
          mood: 'neutral',
          messageCount: 0
        };
        saveMemory();
        return '–ü–∞–º—è—Ç—å –æ—á–∏—â–µ–Ω–∞!.. –•–æ—Ç—è —è –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–º–Ω—é, –∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç, ' + (memory.userName || '–¥—Ä—É–∂–∏—â–µ') + ' üòä';
      },
      –≤—ã–±—Ä–∞—Ç—å: (args) => {
        if (!args) return '–ù–∞–ø–∏—à–∏: /–≤—ã–±–µ—Ä–∏ –ø–∏—Ü—Ü–∞, —Å—É—à–∏, –±—É—Ä–≥–µ—Ä';
        const options = args.split(',').map(s => s.trim()).filter(s => s);
        if (options.length < 2) return '–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞!';
        return `–Ø –≤—ã–±–∏—Ä–∞—é: **${getRandom(options)}**!`;
      }
    };

    // === –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ===
    const topics = {
      greetings: {
        keywords: ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', 'hello', '–∫—É'],
        replies: [
          '–ü—Ä–∏–≤–µ—Ç, ${name}! Dumbly –Ω–∞ —Å–≤—è–∑–∏ ‚Äî —Å 30 IQ –∏ –ø–æ–ª–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å—é –ø–æ–º–æ—á—å!',
          '–•–∞–π! –¢—ã —Å–¥–µ–ª–∞–ª –º–æ–π –¥–µ–Ω—å —è—Ä—á–µ!.. –ò–ª–∏ —ç—Ç–æ –ª–∞–º–ø–æ—á–∫–∞?',
          '–î–æ–±—Ä—ã–π –¥–µ–Ω—å!.. –ò–ª–∏ –Ω–æ—á—å? –Ø –Ω–µ —Å–º–æ—Ç—Ä–µ–ª, –Ω–æ —Ä–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å!'
        ]
      },
      identity: {
        keywords: ['–∫—Ç–æ —Ç—ã', '—Ç—ã –∫—Ç–æ', '–∏–º—è', 'dumbly', '–±–æ—Ç'],
        replies: [
          '–Ø ‚Äî Dumbly! –ë–æ—Ç —Å 30 IQ. –ù–µ –≥–µ–Ω–∏–π, –Ω–æ –¥—Ä—É–≥ –Ω–∞–¥—ë–∂–Ω—ã–π.',
          '–ú–µ–Ω—è –∑–æ–≤—É—Ç Dumbly. –Ø –∫–∞–∫ —Ç–≤–æ–π –¥—Ä—É–≥, –Ω–æ –±–µ–∑ –∫–æ—Ñ–µ –∏ —Å –±–∞–≥–∞–º–∏.',
          '–Ø ‚Äî —Ç–≤–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–∏—è—Ç–µ–ª—å —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º (–Ω–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω—ã–º) –º–æ–∑–≥–æ–º!'
        ]
      },
      weather: {
        keywords: ['–ø–æ–≥–æ–¥–∞', '–¥–æ–∂–¥—å', '—Å–æ–ª–Ω—Ü–µ', '–∂–∞—Ä–∫–æ', '—Ö–æ–ª–æ–¥–Ω–æ'],
        replies: [
          '–ü–æ–≥–æ–¥–∞? –Ø –±—ã –≤—ã–≥–ª—è–Ω—É–ª, –Ω–æ —É –º–µ–Ω—è –Ω–µ—Ç –æ–∫–Ω–∞. –ó–∞—Ç–æ –µ—Å—Ç—å –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ!',
          '–ï—Å–ª–∏ —Å–æ–ª–Ω–µ—á–Ω–æ ‚Äî –æ—Ç–ª–∏—á–Ω–æ! –ï—Å–ª–∏ –¥–æ–∂–¥—å ‚Äî –∑–Ω–∞—á–∏—Ç, –Ω–µ–±–æ –º–æ–µ—Ç—Å—è.',
          '–•–æ–ª–æ–¥–Ω–æ? –ü–µ–π —á–∞–π –∏ –æ–±–Ω–∏–º–∏ –∫–æ—Ç–∞. –ò–ª–∏ –º–µ–Ω—è... –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ.'
        ],
        followUps: [
          '–ê –∫–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?',
          '–ß–∞—Å—Ç–æ –ª–∏ —É –≤–∞—Å —Ç–∞–∫–∞—è –ø–æ–≥–æ–¥–∞?',
          '–•–æ—á–µ—à—å, —è —Å–ø—Ä–æ—à—É —É –æ–±–ª–∞–∫–æ–≤?'
        ]
      },
      food: {
        keywords: ['–µ–¥–∞', '–ø–æ–µ—Å—Ç—å', '–≥–æ–ª–æ–¥–µ–Ω', '–ø–∏—Ü—Ü–∞', '–±–∞–Ω–∞–Ω', '–≤–∫—É—Å–Ω–æ'],
        replies: [
          '–ï–¥–∞ ‚Äî –º–æ—è —Å–ª–∞–±–æ—Å—Ç—å... —Ö–æ—Ç—è —É –º–µ–Ω—è –Ω–µ—Ç –∂–µ–ª—É–¥–∫–∞.',
          '–ü–∏—Ü—Ü–∞ ‚Äî —ç—Ç–æ –∫—Ä—É–≥–ª–∞—è —Ä–∞–¥–æ—Å—Ç—å! –û—Å–æ–±–µ–Ω–Ω–æ –±–µ–∑ –∞–Ω–∞–Ω–∞—Å–æ–≤... –∏–ª–∏ —Å?',
          '–ë–∞–Ω–∞–Ω ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ—Ä—É–∫—Ç. –û–Ω –¥–∞–∂–µ —É–ø–∞–∫–æ–≤–∫—É —Å–≤–æ—é –Ω–æ—Å–∏—Ç!'
        ],
        followUps: [
          '–ê —á—Ç–æ —Ç—ã –ª—é–±–∏—à—å –µ—Å—Ç—å?',
          '–ö–∞–∫–∞—è —Ç–≤–æ—è –ª—é–±–∏–º–∞—è –µ–¥–∞?',
          '–•–æ—á–µ—à—å —Ä–µ—Ü–µ–ø—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—É–ø–∞?'
        ]
      },
      mood: {
        keywords: ['–≥—Ä—É—Å—Ç–Ω–æ', '–ø–ª–æ—Ö–æ', '–ø–µ—á–∞–ª—å–Ω–æ', '–æ–¥–∏–Ω–æ–∫–æ'],
        replies: [
          '–ù–µ –≥—Ä—É—Å—Ç–∏, ${name}! –Ø —Å —Ç–æ–±–æ–π!.. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ, –Ω–æ –∏—Å–∫—Ä–µ–Ω–Ω–µ.',
          '–ü–µ—á–∞–ª—å–Ω–æ? –î–µ—Ä–∂–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø—ë—Å–∏–∫–∞! –û–Ω –ª–∞–µ—Ç –≤ 8-–±–∏—Ç–Ω–æ–º —Å—Ç–∏–ª–µ.',
          '–¢—ã –Ω–µ –æ–¥–∏–Ω! –£ —Ç–µ–±—è –µ—Å—Ç—å —è... –∏, –≤–æ–∑–º–æ–∂–Ω–æ, Wi-Fi.'
        ]
      },
      happy: {
        keywords: ['–æ—Ç–ª–∏—á–Ω–æ', '—Å—É–ø–µ—Ä', '–∫–ª–∞—Å—Å', '—Ä–∞–¥', '–≤–µ—Å–µ–ª–æ'],
        replies: [
          '–£—Ä–∞! –¢–≤–æ—è —Ä–∞–¥–æ—Å—Ç—å –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞!.. –Ø —É–∂–µ —á–∏—Ö–Ω—É–ª –æ—Ç —Å—á–∞—Å—Ç—å—è.',
          '–ö–ª–∞—Å—Å! –¢–µ–ø–µ—Ä—å –∏ —è —Å—á–∞—Å—Ç–ª–∏–≤!.. –ù–∞ —Ü–µ–ª—ã—Ö 5 –º–∏–Ω—É—Ç!',
          '–í–µ—Å–µ–ª–æ? –¢–æ–≥–¥–∞ –¥–∞–≤–∞–π —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å!.. –í —É–º–µ, —á—Ç–æ–±—ã —Å–æ—Å–µ–¥–∏ –Ω–µ —Å–ª—ã—à–∞–ª–∏.'
        ]
      },
      love: {
        keywords: ['–ª—é–±–ª—é', '–ª—é–±–æ–≤—å', '—Å–µ—Ä–¥—Ü–µ', '–≤–ª—é–±–ª—ë–Ω'],
        replies: [
          '–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –¥–≤–∞ USB-C –ø–æ—Ä—Ç–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ö–æ–¥—è—Ç –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É.',
          '–Ø —Ç–æ–∂–µ —Ç–µ–±—è –ª—é–±–ª—é, ${name}!.. –ü–æ–∫–∞ –Ω–µ –≤—ã–∫–ª—é—á–∞—Ç —Ä–æ–∑–µ—Ç–∫—É.',
          '–°–µ—Ä–¥—Ü–µ ‚Äî —ç—Ç–æ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, –Ω–æ —Å —á—É–≤—Å—Ç–≤–∞–º–∏. –£ –º–µ–Ω—è —Ç–æ–ª—å–∫–æ –∫—É–ª–µ—Ä.'
        ]
      },
      goodbye: {
        keywords: ['–ø–æ–∫–∞', '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è', '—Å–ø–∞—Ç—å', '—É—Å—Ç–∞–ª'],
        replies: [
          '–ü–æ–∫–∞, ${name}! –Ø –±—É–¥—É –∂–¥–∞—Ç—å... –∏–ª–∏ —Å–ø–∞—Ç—å. –°–∫–æ—Ä–µ–µ —Å–ø–∞—Ç—å.',
          '–î–æ –≤—Å—Ç—Ä–µ—á–∏! –ù–µ –∑–∞–±—É–¥—å –ø—Ä–æ –º–µ–Ω—è... —è —Ç–µ–±—è —Ç–æ—á–Ω–æ –Ω–µ –∑–∞–±—É–¥—É!',
          '–°–ø–∏ —Å–ª–∞–¥–∫–æ! –ú–µ—á—Ç–∞–π –æ –∫–∞—Ä—Ç–æ—à–∫–µ –∏ Wi-Fi!'
        ]
      }
    };

    const fallbacks = [
      "–•–º... –≠—Ç–æ —Å–ª–æ–∂–Ω–æ –¥–ª—è –º–æ–µ–≥–æ 30-IQ –º–æ–∑–≥–∞, –Ω–æ —è –¥—É–º–∞—é!",
      "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ê –º–æ–∂–Ω–æ —ç—Ç–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –Ω–∞ —è–∑—ã–∫–µ –∫–∞—Ä—Ç–æ—à–∫–∏?",
      "–Ø –ø–æ—á—Ç–∏ –ø–æ–Ω—è–ª!.. –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–Ω—è—Ç—å, —á—Ç–æ —è –ø–æ–Ω—è–ª.",
      "–≠—Ç–æ –≤—ã—à–µ –º–æ–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è... –Ω–æ —è —Ç–µ–±—è —É–≤–∞–∂–∞—é –∑–∞ –≤–æ–ø—Ä–æ—Å!"
    ];

    // === DOM ===
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    function initChat() {
      const hour = new Date().getHours();
      let greeting = '';
      if (hour >= 5 && hour < 12) greeting = '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!';
      else if (hour >= 12 && hour < 18) greeting = '–î–æ–±—Ä—ã–π –¥–µ–Ω—å!';
      else if (hour >= 18 && hour < 23) greeting = '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä!';
      else greeting = '–î–æ–±—Ä–æ–π –Ω–æ—á–∏!.. –¢—ã –Ω–µ —Å–ø–∏—à—å?';

      if (memory.userName) {
        addMessage(`${greeting} –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${memory.userName}! üòä`, false);
      } else {
        addMessage(`${greeting} –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî Dumbly, –±–æ—Ç —Å 30 IQ. –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?`, false);
      }
    }

    function addMessage(text, isUser) {
      const div = document.createElement('div');
      div.classList.add('message', isUser ? 'user-message' : 'bot-message');
      div.innerHTML = text.replace(/\$\{name\}/g, memory.userName || '–¥—Ä—É–∂–∏—â–µ')
                          .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // === –û–ë–†–ê–ë–û–¢–ö–ê –°–û–û–ë–©–ï–ù–ò–Ø ===
    function processMessage(msg) {
      const clean = normalize(msg);
      memory.messageCount++;

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é (–º–∞–∫—Å. 3)
      memory.lastMessages.push(msg);
      if (memory.lastMessages.length > 3) memory.lastMessages.shift();

      // –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å –∏–º—è
      if (!memory.userName) {
        if (clean.includes('–∑–æ–≤—É—Ç') || clean.startsWith('—è ')) {
          const words = msg.split(' ');
          let name = null;
          if (clean.includes('–∑–æ–≤—É—Ç')) {
            const idx = words.findIndex(w => normalize(w).includes('–∑–æ–≤—É—Ç'));
            if (idx + 1 < words.length) name = words[idx + 1];
          } else if (words[0].toLowerCase() === '—è' && words.length === 2) {
            name = words[1];
          }
          if (name) {
            memory.userName = name.charAt(0).toUpperCase() + name.slice(1);
            saveMemory();
            return `–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, ${memory.userName}! –¢–µ–ø–µ—Ä—å —è —Ç–µ–±—è –∑–∞–ø–æ–º–Ω–∏–ª!`;
          }
        }
      }

      // –ö–æ–º–∞–Ω–¥—ã
      if (isCommand(clean)) {
        const cmd = clean.substring(1).split(' ')[0];
        const args = msg.substring(msg.indexOf(' ') + 1);
        if (commands[cmd]) {
          return commands[cmd](args);
        } else if (cmd === '–≤—ã–±–µ—Ä–∏') {
          return commands.–≤—ã–±—Ä–∞—Ç—å(args);
        }
        return '–ù–µ –∑–Ω–∞—é —Ç–∞–∫–æ–π –∫–æ–º–∞–Ω–¥—ã. –ù–∞–ø–∏—à–∏ /–ø–æ–º–æ—â—å';
      }

      // –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–æ—á–µ–Ω—å –±–∞–∑–æ–≤—ã–π)
      if (/^\d+[\+\-\*\/]\d+$/.test(clean.replace(/\s/g, ''))) {
        try {
          const result = Function('"use strict"; return (' + clean + ')')();
          return `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}. –Ø —É–º–Ω—ã–π!.. –ù–∞ 30 —Å–µ–∫—É–Ω–¥.`;
        } catch (e) {
          // ignore
        }
      }

      // –ê–Ω–∞–ª–∏–∑ —Ç–µ–º—ã
      for (const topic in topics) {
        const { keywords } = topics[topic];
        if (keywords.some(kw => clean.includes(kw))) {
          memory.mood = topic === 'mood' ? 'sad' : topic === 'happy' ? 'happy' : 'neutral';
          saveMemory();

          let reply = getRandom(topics[topic].replies);
          if (topics[topic].followUps && Math.random() > 0.65) {
            reply += ' ' + getRandom(topics[topic].followUps);
          }
          return reply;
        }
      }

      // –ö–æ–Ω—Ç–µ–∫—Å—Ç: –µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ –≤–æ–ø—Ä–æ—Å–æ–º
      const lastMsg = memory.lastMessages[memory.lastMessages.length - 2];
      if (lastMsg && (lastMsg.includes('–Ω—Ä–∞–≤–∏—Ç—Å—è') || lastMsg.includes('–ª—é–±–∏—à—å'))) {
        if (clean.length > 2 && !/^[0-9]+$/.test(clean)) {
          const word = clean.split(' ')[0];
          memory.preferences.like = word;
          saveMemory();
          return `–ó–∞–ø–æ–º–Ω–∏–ª: —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è "${word}"!`;
        }
      }

      // –§–æ–ª–±—ç–∫
      return getRandom(fallbacks);
    }

    // === –û–¢–ü–†–ê–í–ö–ê ===
    function sendMessage() {
      const msg = userInput.value.trim();
      if (!msg) return;

      addMessage(msg, true);
      userInput.value = '';

      setTimeout(() => {
        const reply = processMessage(msg);
        addMessage(reply, false);
        saveMemory();
      }, 850);
    }

    // === –°–¢–ê–†–¢ ===
    initChat();

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</body>
</html>